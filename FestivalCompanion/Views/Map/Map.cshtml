@model IAsyncEnumerable<FestivalCompanion.Models.Location>
@using System.Text.Json

@{
	ViewData["Title"] = "Map";
	var locations = new List<FestivalCompanion.Models.Location>();
}

@await foreach (var location in Model)
{
	locations.Add(location);
}


<div id="map" style="height:100vh; width:100vw;"></div>

@section Scripts {
    <script>
        $(function () {
            var map = L.map('map').setView([51.53553000, 5.07792000], 16);

			L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: '&copy; OpenStreetMap contributors',
				maxZoom: 19
			}).addTo(map);
			
			var podiumIcon = L.icon({ iconUrl: '/img/podiumIcon.png', iconSize: [70,85] });
			var eettentIcon = L.icon({ iconUrl: '/img/eettentIcon.png', iconSize: [70,85] });
			var bierkraamIcon = L.icon({ iconUrl: '/img/bierkraam.png', iconSize: [70,85] });
			var toiletIcon   = L.icon({ iconUrl: '/img/toiletIcon.png', iconSize: [70,85] });
			var standaardIcon = L.icon({ iconUrl: '/img/toiletIcon.png', iconSize: [70,85] });


			var markers = @Html.Raw(JsonSerializer.Serialize(
				locations.Select(l => new
				{
					latitude = l.Breedtegraad,
					longitude = l.Lengtegraad,
					popup = l.Naam ?? "",
					type = l.Type
				})
			));

			markers.forEach(function (m) {
				var iconToUse;

				switch(m.type.trim().toLowerCase()){
					case "podium":
						iconToUse = podiumIcon;
						break;
					case "bierkraam":
						iconToUse = bierkraamIcon;
						break;
					case "toilet":
						iconToUse = toiletIcon;
						break;
					case "eettent":
						iconToUse = eettentIcon;
						break;
					default:
						iconToUse = standaardIcon;
				}

				L.marker([m.longitude, m.latitude], {icon: iconToUse})
				.addTo(map)
				.bindPopup(m.popup).openPopup();
			});

			setTimeout(function () { map.invalidateSize(); }, 200);
		});
	</script>
}
