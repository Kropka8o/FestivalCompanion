@model IAsyncEnumerable<FestivalCompanion.Models.Location>
@using System.Text.Json

@{
    ViewData["Title"] = "Map";
    var locations = new List<FestivalCompanion.Models.Location>();
}


@await foreach (var location in Model)
{
    locations.Add(location);
}

<div id="map" style="height:100vh; width:100vw;"></div>

@section Scripts {
    <script>
        $(function () {
            var map = L.map('map').setView([51.53553000, 5.07792000], 16);

            


            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            var markers = @Html.Raw(JsonSerializer.Serialize(
                locations.Select(l => new {
                    latitude = l.Breedtegraad,
                    longitude = l.Lengtegraad,
                    popup = l.Naam ?? ""
                })
            ));

            markers.forEach(function (m) {
                L.marker([m.longitude, m.latitude]).addTo(map).bindPopup(m.popup).openPopup();
            });

            setTimeout(function () { map.invalidateSize(); }, 200);
        });
    </script>
}
